{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://arbiter.dev/schemas/v1/embedding.schema.json",
  "title": "Arbiter Debug Embedding JSONL Record",
  "oneOf": [
    {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "trial_id",
        "embedding_status",
        "vector_b64",
        "dtype",
        "encoding",
        "dimensions",
        "embed_text_truncated",
        "embed_text_original_chars",
        "embed_text_final_chars",
        "truncation_reason"
      ],
      "properties": {
        "trial_id": { "type": "integer", "minimum": 0 },
        "embedding_status": { "const": "success" },
        "vector_b64": { "type": "string", "minLength": 1 },
        "dtype": { "const": "float32" },
        "encoding": { "const": "float32le_base64" },
        "dimensions": { "type": "integer", "minimum": 1 },
        "embed_text_sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "embed_text_truncated": { "type": "boolean" },
        "embed_text_original_chars": { "type": "integer", "minimum": 0 },
        "embed_text_final_chars": { "type": "integer", "minimum": 0 },
        "truncation_reason": { "type": ["string", "null"] }
      }
    },
    {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "trial_id",
        "embedding_status",
        "vector_b64",
        "dtype",
        "encoding",
        "error",
        "embed_text_truncated",
        "embed_text_original_chars",
        "embed_text_final_chars",
        "truncation_reason"
      ],
      "properties": {
        "trial_id": { "type": "integer", "minimum": 0 },
        "embedding_status": { "const": "failed" },
        "vector_b64": { "type": "null" },
        "dtype": { "const": "float32" },
        "encoding": { "const": "float32le_base64" },
        "error": { "type": "string", "minLength": 1 },
        "dimensions": { "type": "integer", "minimum": 1 },
        "embed_text_sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "embed_text_truncated": { "type": "boolean" },
        "embed_text_original_chars": { "type": "integer", "minimum": 0 },
        "embed_text_final_chars": { "type": "integer", "minimum": 0 },
        "truncation_reason": { "type": ["string", "null"] }
      }
    },
    {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "trial_id",
        "embedding_status",
        "vector_b64",
        "dtype",
        "encoding",
        "skip_reason",
        "embed_text_truncated",
        "embed_text_original_chars",
        "embed_text_final_chars",
        "truncation_reason"
      ],
      "properties": {
        "trial_id": { "type": "integer", "minimum": 0 },
        "embedding_status": { "const": "skipped" },
        "vector_b64": { "type": "null" },
        "dtype": { "const": "float32" },
        "encoding": { "const": "float32le_base64" },
        "skip_reason": { "type": "string", "minLength": 1 },
        "dimensions": { "type": "integer", "minimum": 1 },
        "embed_text_sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "embed_text_truncated": { "type": "boolean" },
        "embed_text_original_chars": { "type": "integer", "minimum": 0 },
        "embed_text_final_chars": { "type": "integer", "minimum": 0 },
        "truncation_reason": { "type": ["string", "null"] }
      }
    }
  ]
}
