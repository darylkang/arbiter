{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://arbiter.dev/schemas/v1/cluster-state.schema.json",
  "title": "Arbiter Online Clustering State",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "algorithm", "params", "clusters", "totals"],
  "properties": {
    "schema_version": { "const": "1.0.0" },
    "algorithm": { "const": "online_leader" },
    "params": {
      "type": "object",
      "additionalProperties": false,
      "required": ["tau", "centroid_update_rule", "ordering_rule", "cluster_limit"],
      "properties": {
        "tau": { "type": "number", "minimum": 0, "maximum": 1 },
        "centroid_update_rule": {
          "type": "string",
          "enum": ["fixed_leader", "incremental_mean"]
        },
        "ordering_rule": { "const": "trial_id_asc" },
        "cluster_limit": { "type": "integer", "minimum": 1 }
      }
    },
    "clusters": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "cluster_id",
          "exemplar_trial_id",
          "member_count",
          "discovered_at_batch"
        ],
        "properties": {
          "cluster_id": { "type": "integer", "minimum": 0 },
          "exemplar_trial_id": { "type": "integer", "minimum": 0 },
          "member_count": { "type": "integer", "minimum": 1 },
          "discovered_at_batch": { "type": "integer", "minimum": 0 },
          "centroid_vector_b64": { "type": "string", "minLength": 1 }
        }
      }
    },
    "totals": {
      "type": "object",
      "additionalProperties": false,
      "required": ["total_assigned", "total_excluded", "forced_assignments"],
      "properties": {
        "total_assigned": { "type": "integer", "minimum": 0 },
        "total_excluded": { "type": "integer", "minimum": 0 },
        "forced_assignments": { "type": "integer", "minimum": 0 }
      }
    }
  }
}
