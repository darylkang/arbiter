{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://arbiter.dev/schemas/v1/embeddings-provenance.schema.json",
  "title": "Arbiter Embeddings Provenance",
  "oneOf": [
    {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "schema_version",
        "status",
        "reason",
        "primary_format",
        "intended_primary_format",
        "dtype"
      ],
      "properties": {
        "schema_version": { "const": "1.0.0" },
        "status": { "const": "not_generated" },
        "reason": { "type": "string", "minLength": 1 },
        "primary_format": { "const": "none" },
        "intended_primary_format": { "const": "arrow_ipc_file" },
        "dtype": { "const": "float32" },
        "dimensions": { "type": ["integer", "null"], "minimum": 1 },
        "note": { "type": "string" }
      }
    },
    {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "schema_version",
        "status",
        "primary_format",
        "intended_primary_format",
        "dtype",
        "dimensions",
        "counts",
        "debug_jsonl_present"
      ],
      "properties": {
        "schema_version": { "const": "1.0.0" },
        "status": { "const": "arrow_generated" },
        "primary_format": { "const": "arrow" },
        "intended_primary_format": { "const": "arrow_ipc_file" },
        "dtype": { "const": "float32" },
        "dimensions": { "type": "integer", "minimum": 1 },
        "counts": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "total_trials",
            "successful_embeddings",
            "failed_embeddings",
            "skipped_embeddings"
          ],
          "properties": {
            "total_trials": { "type": "integer", "minimum": 0 },
            "successful_embeddings": { "type": "integer", "minimum": 0 },
            "failed_embeddings": { "type": "integer", "minimum": 0 },
            "skipped_embeddings": { "type": "integer", "minimum": 0 }
          }
        },
        "debug_jsonl_present": { "type": "boolean" },
        "embedding_model": { "type": "string", "minLength": 1 },
        "embed_text_strategy": { "type": "string", "minLength": 1 },
        "normalization": { "type": "string", "minLength": 1 },
        "jsonl_encoding": { "const": "float32le_base64" }
      }
    },
    {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "schema_version",
        "status",
        "primary_format",
        "intended_primary_format",
        "dtype",
        "dimensions",
        "arrow_error",
        "debug_jsonl_present",
        "jsonl_encoding"
      ],
      "properties": {
        "schema_version": { "const": "1.0.0" },
        "status": { "const": "jsonl_fallback" },
        "primary_format": { "const": "jsonl" },
        "intended_primary_format": { "const": "arrow_ipc_file" },
        "dtype": { "const": "float32" },
        "dimensions": { "type": "integer", "minimum": 1 },
        "arrow_error": { "type": "string", "minLength": 1 },
        "debug_jsonl_present": { "type": "boolean" },
        "jsonl_encoding": { "const": "float32le_base64" },
        "counts": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "total_trials",
            "successful_embeddings",
            "failed_embeddings",
            "skipped_embeddings"
          ],
          "properties": {
            "total_trials": { "type": "integer", "minimum": 0 },
            "successful_embeddings": { "type": "integer", "minimum": 0 },
            "failed_embeddings": { "type": "integer", "minimum": 0 },
            "skipped_embeddings": { "type": "integer", "minimum": 0 }
          }
        }
      }
    }
  ]
}
